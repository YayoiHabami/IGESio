# Surface of Revolution (Type 120)

Defined in [surfaces/surface_of_revolution.h](./../../../include/igesio/entities/surfaces/surface_of_revolution.h)

## Table of Contents

- [Table of Contents](#table-of-contents)
- [Parameters](#parameters)
  - [Intrinsic Parameters](#intrinsic-parameters)
  - [Surface Definition](#surface-definition)
    - [Parametric Surface $S(u, v)$](#parametric-surface-su-v)
    - [Partial Derivatives $S\_u, S\_v, S\_{uu}, S\_{uv}, S\_{vv}$](#partial-derivatives-s_u-s_v-s_uu-s_uv-s_vv)
- [Appendix](#appendix)
  - [Derivation of the Surface Equation](#derivation-of-the-surface-equation)
  - [Derivation of Partial Derivatives](#derivation-of-partial-derivatives)

## Parameters

### Intrinsic Parameters

| Member Function | Description |
|---|---|
| `GetAxis()` <br> `SetAxis(line)` <br> (`std::shared_ptr<const Line>`) | Pointer to the axis of revolution $L$ |
| `GetGeneratrix()` <br> `SetGeneratrix(curve)` <br> (`std::shared_ptr<const ICurve>`) | Pointer to the generatrix curve $C(t)$ |
| `GetAngleRange()` <br> `SetAngleRange(range)` <br> (`std::array<double, 2>`) | Range of rotation angles $[\theta_s, \theta_e]$ [rad] |

### Surface Definition

#### Parametric Surface $S(u, v)$

A surface of revolution is generated by rotating a generatrix curve $C(t)$ about an axis $L$. The axis is defined as a Line (Type 110) entity, represented by a start point $P_0 \ (\in \mathbb{R}^3)$ and a direction vector $D \ (\in \mathbb{R}^3,\ \lVert D \rVert = 1)$. For more details, see [Appendix - Derivation of the Surface Equation](#derivation-of-the-surface-equation).

$$S(u, v) = P_0 + C_P(u) \cos{v} + \left( D \times C_P(u) \right) \sin{v} + D \left( D \cdot C_P(u) \right) (1 - \cos{v})$$

where $C_P(u) := C(u) - P_0$. The parameter $u$ corresponds to the parameter range $[t_{\text{min}}, t_{\text{max}}]$ of the generatrix $C(t)$, and $v$ corresponds to the rotation angle range $[\theta_s, \theta_e]$.

#### Partial Derivatives $S_u, S_v, S_{uu}, S_{uv}, S_{vv}$

The partial derivatives of the surface of revolution, $S_u, S_v, S_{uu}, S_{uv}, S_{vv}$, are defined as follows. For detailed derivations, refer to [Appendix - Derivation of Partial Derivatives](#derivation-of-partial-derivatives).

**First-order partial derivatives:**

$$\begin{aligned}
    S_u(u, v) &= C'(u) \cos{v} + \left( D \times C'(u) \right) \sin{v} + D \left( D \cdot C'(u) \right) (1 - \cos{v}) \\\
    S_v(u, v) &= -C_P(u) \sin{v} + \left( D \times C_P(u) \right) \cos{v} + D \left( D \cdot C_P(u) \right) \sin{v}
\end{aligned}$$

**Second-order partial derivatives:**

$$\begin{aligned}
    S_{uu}(u, v) &= C''(u) \cos{v} + \left( D \times C''(u) \right) \sin{v} + D \left( D \cdot C''(u) \right) (1 - \cos{v}) \\\
    S_{uv}(u, v) &= -C'(u) \sin{v} + \left( D \times C'(u) \right) \cos{v} + D \left( D \cdot C'(u) \right) \sin{v} \\\
    S_{vv}(u, v) &= -C_P(u) \cos{v} - \left( D \times C_P(u) \right) \sin{v} + D \left( D \cdot C_P(u) \right) \cos{v}
\end{aligned}$$

For geometric properties that can be computed from $S(u,v)$ and its derivatives, see [geometric_properties.md](./../geometric_properties.md#geometric-properties-of-surfaces).

## Appendix

### Derivation of the Surface Equation

A surface of revolution is generated by rotating the generatrix curve $C(t)$ about the axis $L$. The axis $L$ is defined as a [Line (Type 110) entity](./../curves/110_line.md) by its start point $P_1$ and end point $P_2$. The axis origin $P_0 \ (\in \mathbb{R}^3)$ and direction vector $D \ (\in \mathbb{R}^3,\ \lVert D \rVert = 1)$ are given by:

$$\begin{aligned}
    P_0 &= P_1 \\\
    D &= \frac{P_2 - P_1}{\lVert P_2 - P_1 \rVert}
\end{aligned}$$

Each point $C(x) \ (x \in [t_{\text{min}}, t_{\text{max}}])$ on the generatrix, when rotated by an angle $\theta \ ( \theta \in [\theta_s, \theta_e])$ about the axis $L$, yields the point $S(x, \theta)$, which can be expressed using Rodrigues' rotation formula:

$$\begin{aligned}
    S(x, \theta) &= P_0 + C_P(x) \cos{\theta} + \left( D \times C_P(x) \right) \sin{\theta} + D \left( D \cdot C_P(x) \right) (1 - \cos{\theta})  \\\
    &= \left( P_0 + D \left( D \cdot C_P(x) \right) \right) + \left( C_P(x) - D \left( D \cdot C_P(x) \right) \right) \cos{\theta} + \left( D \times C_P(x) \right) \sin{\theta}
\end{aligned}$$

where $C_P(x) := C(x) - P_0$. Hereafter, we use $u = x, v = \theta$ and denote the parametric surface as $S(u, v)$.

### Derivation of Partial Derivatives

Let $C'(t)$ and $C''(t)$ denote the first and second derivatives of the generatrix $C(t)$. For $C_P(u) := C(u) - P_0$, the derivatives are:

$$\begin{aligned}
    C_P'(u) &= \frac{d}{du} (C(u) - P_0) = C'(u) \\\
    C_P''(u) &= \frac{d^2}{du^2} (C(u) - P_0) = C''(u)
\end{aligned}$$

Thus, the partial derivatives of the surface $S(u, v)$ are derived as follows.

**First-order partial derivatives:**

$$\begin{aligned}
    S_u(u, v) &= C'(u) \cos{v} + \left( D \times C'(u) \right) \sin{v} + D \left( D \cdot C'(u) \right) (1 - \cos{v}) \\\
    S_v(u, v) &= -C_P(u) \sin{v} + \left( D \times C_P(u) \right) \cos{v} + D \left( D \cdot C_P(u) \right) \sin{v}
\end{aligned}$$

**Second-order partial derivatives:**

$$\begin{aligned}
    S_{uu}(u, v) &= C''(u) \cos{v} + \left( D \times C''(u) \right) \sin{v} + D \left( D \cdot C''(u) \right) (1 - \cos{v}) \\\
    S_{uv}(u, v) &= -C'(u) \sin{v} + \left( D \times C'(u) \right) \cos{v} + D \left( D \cdot C'(u) \right) \sin{v} \\\
    S_{vv}(u, v) &= -C_P(u) \cos{v} - \left( D \times C_P(u) \right) \sin{v} + D \left( D \cdot C_P(u) \right) \cos{v}
\end{aligned}$$

**Higher-order derivatives:**

$$S^{(n_u, n_v)}(u, v) = \begin{cases}
    P_0 + C_P(u) \cos{v} + \left( D \times C_P(u) \right) \sin{v} + D \left( D \cdot C_P(u) \right) (1 - \cos{v}) & (n_u = 0, n_v = 0) \\\
    C^{(n_u)}(u) \cos{v} + \left( D \times C^{(n_u)}(u) \right) \sin{v} + D \left( D \cdot C^{(n_u)}(u) \right) (1 - \cos{v}) & (n_u \geq 1, n_v = 0) \\\
    \left(C_P(u) - D \left( D \cdot C_P(u) \right)\right)\cos(v + \frac{n_v \pi}{2}) + \left(D \times C_P(u)\right) \sin(v + \frac{n_v \pi}{2}) & (n_u = 0, n_v \geq 1) \\\
    \left(C^{(n_u)}(u) - D \left( D \cdot C^{(n_u)}(u) \right)\right)\cos(v + \frac{n_v \pi}{2}) + \left(D \times C^{(n_u)}(u)\right) \sin(v + \frac{n_v \pi}{2}) & (n_u \geq 1, n_v \geq 1)
\end{cases}$$

